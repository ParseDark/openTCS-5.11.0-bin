<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="The openTCS developers">
<title>openTCS: Developer&#8217;s Guide</title>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="./font-awesome.css">
<link rel="stylesheet" href="../../_assets/css/style.css">
<link rel="stylesheet" href="../../_assets/css/font-awesome.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>openTCS: Developer&#8217;s Guide</h1>
<div class="details">
<span id="author" class="author">The openTCS developers</span><br>
<span id="revnumber">version 5.11.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_development_with_opentcs_in_general">1. Development with openTCS in general</a>
<ul class="sectlevel2">
<li><a href="#_system_requirements">1.1. System requirements</a></li>
<li><a href="#_available_artifacts_and_api_compatibility">1.2. Available artifacts and API compatibility</a></li>
<li><a href="#_third_party_dependencies">1.3. Third-party dependencies</a></li>
<li><a href="#_modularity_and_extensibility">1.4. Modularity and extensibility</a></li>
<li><a href="#_logging">1.5. Logging</a></li>
<li><a href="#_working_with_the_opentcs_source_code">1.6. Working with the openTCS source code</a></li>
<li><a href="#_opentcs_kernel_apis">1.7. openTCS kernel APIs</a></li>
</ul>
</li>
<li><a href="#section-kernel-api">2. The kernel&#8217;s Java API</a>
<ul class="sectlevel2">
<li><a href="#_acquiring_service_objects">2.1. Acquiring service objects</a></li>
<li><a href="#_working_with_transport_orders">2.2. Working with transport orders</a>
<ul class="sectlevel3">
<li><a href="#_a_transport_orders_life_cycle">2.2.1. A transport order&#8217;s life cycle</a></li>
<li><a href="#_structure_and_processing_of_transport_orders">2.2.2. Structure and processing of transport orders</a></li>
<li><a href="#_how_to_create_a_transport_order">2.2.3. How to create a transport order</a></li>
<li><a href="#_how_to_create_a_transport_order_that_sends_a_vehicle_to_a_point_instead_of_a_location">2.2.4. How to create a transport order that sends a vehicle to a point instead of a location</a></li>
<li><a href="#_how_to_work_with_order_sequences">2.2.5. How to work with order sequences</a></li>
<li><a href="#_how_to_withdraw_a_transport_order">2.2.6. How to withdraw a transport order</a></li>
<li><a href="#_how_to_withdraw_a_transport_order_via_a_vehicle_reference">2.2.7. How to withdraw a transport order via a vehicle reference</a></li>
</ul>
</li>
<li><a href="#_using_the_event_bus">2.3. Using the event bus</a></li>
</ul>
</li>
<li><a href="#_generating_an_integration_project">3. Generating an integration project</a></li>
<li><a href="#_customizing_and_extending_the_kernel_application">4. Customizing and extending the kernel application</a>
<ul class="sectlevel2">
<li><a href="#_guice_modules">4.1. Guice modules</a></li>
<li><a href="#_replacing_default_kernel_components">4.2. Replacing default kernel components</a></li>
<li><a href="#_developing_vehicle_drivers">4.3. Developing vehicle drivers</a>
<ul class="sectlevel3">
<li><a href="#_classes_and_interfaces_for_the_kernel">4.3.1. Classes and interfaces for the kernel</a></li>
<li><a href="#_classes_and_interfaces_for_the_control_center_application">4.3.2. Classes and interfaces for the control center application</a></li>
<li><a href="#_steps_to_create_a_new_vehicle_driver">4.3.3. Steps to create a new vehicle driver</a></li>
<li><a href="#_registering_a_vehicle_driver_with_the_kernel">4.3.4. Registering a vehicle driver with the kernel</a></li>
</ul>
</li>
<li><a href="#_sending_messages_to_communication_adapters">4.4. Sending messages to communication adapters</a></li>
<li><a href="#_acquiring_data_from_communication_adapters">4.5. Acquiring data from communication adapters</a></li>
<li><a href="#_developing_peripheral_drivers">4.6. Developing peripheral drivers</a>
<ul class="sectlevel3">
<li><a href="#_classes_and_interfaces_for_the_kernel_2">4.6.1. Classes and interfaces for the kernel</a></li>
<li><a href="#_classes_and_interfaces_for_the_control_center_application_2">4.6.2. Classes and interfaces for the control center application</a></li>
<li><a href="#_steps_to_create_a_new_peripheral_driver">4.6.3. Steps to create a new peripheral driver</a></li>
<li><a href="#_registering_a_peripheral_driver_with_the_kernel">4.6.4. Registering a peripheral driver with the kernel</a></li>
</ul>
</li>
<li><a href="#section-kernel-executor">4.7. Executing code in kernel context</a></li>
</ul>
</li>
<li><a href="#_customizing_and_extending_the_control_center_application">5. Customizing and extending the control center application</a>
<ul class="sectlevel2">
<li><a href="#_guice_modules_2">5.1. Guice modules</a></li>
<li><a href="#_registering_driver_panels_with_the_control_center">5.2. Registering driver panels with the control center</a></li>
</ul>
</li>
<li><a href="#_customizing_and_extending_the_model_editor_and_the_operations_desk_applications">6. Customizing and extending the Model Editor and the Operations Desk applications</a>
<ul class="sectlevel2">
<li><a href="#_guice_modules_3">6.1. Guice modules</a></li>
<li><a href="#_how_to_add_importexport_functionality_for_plant_model_data">6.2. How to add import/export functionality for plant model data</a></li>
<li><a href="#_how_to_create_a_plugin_panel_for_the_operations_desk_client">6.3. How to create a plugin panel for the Operations Desk client</a></li>
<li><a href="#_how_to_create_a_locationvehicle_theme_for_opentcs">6.4. How to create a location/vehicle theme for openTCS</a></li>
</ul>
</li>
<li><a href="#_supplementing_configuration_sources">7. Supplementing configuration sources</a></li>
<li><a href="#_translating_the_user_interfaces">8. Translating the user interfaces</a>
<ul class="sectlevel2">
<li><a href="#_extracting_default_language_files">8.1. Extracting default language files</a></li>
<li><a href="#_creating_a_translation">8.2. Creating a translation</a></li>
<li><a href="#_integrating_a_translation">8.3. Integrating a translation</a></li>
<li><a href="#_updating_a_translation">8.4. Updating a translation</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_development_with_opentcs_in_general">1. Development with openTCS in general</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_system_requirements">1.1. System requirements</h3>
<div class="paragraph">
<p>The openTCS source code is written in Java.
To compile it, you need a Java Development Kit (JDK) 13.
To run the resulting binaries, you need a Java Runtime Environment (JRE) 13.
All other required libraries are included in the openTCS distribution or will be downloaded automatically when building it from source code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_available_artifacts_and_api_compatibility">1.2. Available artifacts and API compatibility</h3>
<div class="paragraph">
<p>The openTCS project publishes artifacts for releases via the <a href="https://repo1.maven.org/maven2/">Maven Central</a> artifact repository, so you can easily integrate them with build systems such as Gradle or Maven.
In Gradle build scripts, for example, use something like the following to integrate an openTCS library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
  mavenCentral()
}

dependencies {
  compile group: 'org.opentcs', name: '${ARTIFACT}', version: '5.11.0'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the version number of the openTCS release you actually want to work with, and select the appropriate <code>${ARTIFACT}</code> name from the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Artifacts published by the openTCS project</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact name</th>
<th class="tableblock halign-left valign-top">API compatibility between minor releases</th>
<th class="tableblock halign-left valign-top">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-api-base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base API for clients and extensions.
This is what most developers probably want to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-api-injection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API interfaces and classes used for dependency injection within the kernel and client applications.
This is required in integration projects customizing these applications, e.g. adding components like vehicle driver implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-common</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A collection of utility classes used by openTCS components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-impl-configuration-cfg4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An implementation of the base API&#8217;s configuration interfaces based on cfg4j.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-kernel-extension-http-services</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A kernel extension providing the web API implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-kernel-extension-rmi-services</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A kernel extension providing the RMI interface implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-kernel-extension-statistics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A kernel extension providing the statistics collection implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base data structures and components used by the Model Editor and the Operations Desk that don&#8217;t require third-party libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-common</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A collection of classes and components commonly used by the Model Editor and the Operations Desk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-panel-loadgenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The load generator panel implementation for the Operations Desk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-panel-resourceallocation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resource allocation panel implemenation for the Operations Desk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-panel-statistics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The statistics panel implementation for the Operations Desk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-plantoverview-themes-default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default themes implementation for the Operations Desk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-commadapter-loopback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A very basic vehicle driver simulating a virtual vehicle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-strategies-default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default implementations of strategies that are used by the kernel application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-kernel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The kernel application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-kernelcontrolcenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kernel Control Center application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-modeleditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Model Editor application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opentcs-operationsdesk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Operations Desk application.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that only the basic API libraries provide a documented API that the openTCS developers try to keep compatible between minor releases.
(For these libraries, the rules of <a href="https://semver.org/">semantic versioning</a> are applied.)
All other artifacts' contents can and will change regardless of any compatibility concerns, so if you explicitly use these as dependencies and switch to a different version of openTCS, you may have to adjust and recompile your code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_third_party_dependencies">1.3. Third-party dependencies</h3>
<div class="paragraph">
<p>The kernel and the client applications depend on the following external frameworks and libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SLF4J (<a href="https://www.slf4j.org/" class="bare">https://www.slf4j.org/</a>):
A simple logging facade to keep the actual logging implementation replaceable.</p>
</li>
<li>
<p>Google Guice (<a href="https://github.com/google/guice" class="bare">https://github.com/google/guice</a>):
A light-weight dependency injection framework.</p>
</li>
<li>
<p>Cfg4j (<a href="http://www.cfg4j.org/" class="bare">http://www.cfg4j.org/</a>):
A configuration library supporting binding interfaces.</p>
</li>
<li>
<p>Google Guava (<a href="https://github.com/google/guava" class="bare">https://github.com/google/guava</a>):
A collection of small helper classes and methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The kernel application also depends on the following libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JGraphT (<a href="https://jgrapht.org/" class="bare">https://jgrapht.org/</a>):
A library for working with graphs and using algorithms on them.</p>
</li>
<li>
<p>Spark (<a href="https://sparkjava.com/" class="bare">https://sparkjava.com/</a>):
A framework for creating web applications.</p>
</li>
<li>
<p>Jackson (<a href="https://github.com/FasterXML/jackson" class="bare">https://github.com/FasterXML/jackson</a>):
Provides JSON bindings for Java objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Model Editor and Operations Desk applications have the following additional dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JHotDraw (<a href="https://github.com/wrandelshofer/jhotdraw" class="bare">https://github.com/wrandelshofer/jhotdraw</a>):
A framework for drawing graph structures (like driving course models).</p>
</li>
<li>
<p>Docking Frames (<a href="https://www.docking-frames.org/" class="bare">https://www.docking-frames.org/</a>):
A framework for docking and undocking of GUI panels</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For automatic tests, the following dependencies are used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JUnit (<a href="https://junit.org/" class="bare">https://junit.org/</a>):
A simple unit-testing framework.</p>
</li>
<li>
<p>Mockito (<a href="https://site.mockito.org/" class="bare">https://site.mockito.org/</a>):
A framework for creating mock objects.</p>
</li>
<li>
<p>Hamcrest (<a href="http://hamcrest.org/" class="bare">http://hamcrest.org/</a>):
A framework for assertion matchers that can be used in tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The artifacts for these dependencies are downloaded automatically when building the applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modularity_and_extensibility">1.4. Modularity and extensibility</h3>
<div class="paragraph">
<p>The openTCS project heavily relies on <a href="https://github.com/google/guice">Guice</a> for dependency injection and wiring of components as well as for providing plugin-like extension mechanisms.
In the injection API, relevant classes can be found in the package <code>org.opentcs.customizations</code>.
For examples, see <a href="#_customizing_and_extending_the_kernel_application">Customizing and extending the kernel application</a>, <a href="#_customizing_and_extending_the_model_editor_and_the_operations_desk_applications">Customizing and extending the Model Editor and the Operations Desk applications</a> and <a href="#_customizing_and_extending_the_control_center_application">Customizing and extending the control center application</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging">1.5. Logging</h3>
<div class="paragraph">
<p>The code in the official openTCS distribution uses <a href="https://www.slf4j.org/">SLF4J</a> for logging.
Thus, the actual logging implementation is easily interchangeable by replacing the SLF4J binding in the respective application&#8217;s classpath.
The kernel and client applications come with SLF4J&#8217;s bindings for <code>java.util.logging</code> by default.
For more information on how to change the actual logging implementation, e.g. to use log4j, please see the SLF4J documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_the_opentcs_source_code">1.6. Working with the openTCS source code</h3>
<div class="paragraph">
<p>The openTCS project itself uses <a href="https://gradle.org/">Gradle</a> as its build management tool.
To build openTCS from source code, just run <code>gradlew build</code> from the source distribution&#8217;s main directory.
For details on how to work with Gradle, please see <a href="https://docs.gradle.org/">its documentation</a>.</p>
</div>
<div class="paragraph">
<p>These are the main Gradle tasks of the root project you need to know to get started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build</code>: Compiles the source code of all subprojects.</p>
</li>
<li>
<p><code>release</code>: Builds and packages all system components to a distribution in <code>build/</code>.</p>
</li>
<li>
<p><code>clean</code>: Cleans up everything produced by the other tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To work with the source code in your IDE, see the IDE&#8217;s documentation for Gradle integration.
There is no general recommendation for any specific IDE.
Note, however, that the openTCS source code contains GUI components that have been created with the NetBeans GUI builder.
If you want to edit these, you may want to use the NetBeans IDE.</p>
</div>
</div>
<div class="sect2">
<h3 id="_opentcs_kernel_apis">1.7. openTCS kernel APIs</h3>
<div class="paragraph">
<p>openTCS provides the following APIs to interact with the kernel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The kernel&#8217;s Java API for both extending the kernel application as well as interfacing with it via RMI.
See <a href="#section-kernel-api">The kernel&#8217;s Java API</a> for details.</p>
</li>
<li>
<p>A web API for interfacing with the kernel via HTTP calls.
See the separate interface documentation that is part of the openTCS distribution for details.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="section-kernel-api">2. The kernel&#8217;s Java API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The interfaces and classes required to use the kernel API are part of the <code>opentcs-api-base</code> JAR file, so you should add that to your classpath/declare a dependency on it.
(See <a href="#_available_artifacts_and_api_compatibility">Available artifacts and API compatibility</a>.)
The basic data structures for plant model components and transport orders you will encounter often are the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tcsobject_classes.png" alt="tcsobject classes">
</div>
<div class="title">Figure 1. Basic data structures</div>
</div>
<div class="paragraph">
<p>The service interfaces that are most often interacted with to fetch and manipulate such data structures are these:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service_interfaces_tcsobjects.png" alt="service interfaces tcsobjects">
</div>
<div class="title">Figure 2. TCSObject-related service interfaces</div>
</div>
<div class="paragraph">
<p>A few more interfaces are available to interact with various parts of the kernel, as shown in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service_interfaces_others.png" alt="service interfaces others">
</div>
<div class="title">Figure 3. Additional service interfaces</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Peripheral*</em> are classes/interfaces related to experimental integration of peripheral devices.
These features are not documented in detail, yet, and developers using any of them are on their own, for now.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_acquiring_service_objects">2.1. Acquiring service objects</h3>
<div class="paragraph">
<p>To use the services in code running inside the kernel JVM, e.g. a vehicle driver, simply request an instance of e.g. <code>PlantModelService</code> to be provided via dependency injection.
You may also work with an instance of <code>InternalPlantModelService</code> here, which provides additional methods available only to kernel application components.</p>
</div>
<div class="paragraph">
<p>To access the services from another JVM, e.g. in a client that is supposed to create transport orders or to receive status updates for transport orders or vehicles, you need to connect to them via Remote Method Invocation (RMI).
The easiest way to do this is by creating an instance of the <code>KernelServicePortalBuilder</code> class and letting it build a <code>KernelServicePortal</code> instance for you.
(For now, there isn&#8217;t much support for user management, so it is recommended to ignore the methods that require user credentials.)
After creating the <code>KernelServicePortal</code> instance, you can use it to get service instances and fetch kernel events from it.
See also the class documentation for <code>KernelServicePortalBuilder</code> in the base API&#8217;s JavaDoc documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KernelServicePortal servicePortal = <span class="keyword">new</span> KernelServicePortalBuilder().build();

<span class="comment">// Connect and log in with a kernel somewhere.</span>
servicePortal.login(<span class="string"><span class="delimiter">&quot;</span><span class="content">someHost</span><span class="delimiter">&quot;</span></span>, <span class="integer">1099</span>);

<span class="comment">// Get a reference to the plant model service...</span>
PlantModelService plantModelService = servicePortal.getPlantModelService();
<span class="comment">// ...and find out the name of the currently loaded model.</span>
<span class="predefined-type">String</span> modelName = plantModelService.getLoadedModelName();

<span class="comment">// Poll events, waiting up to a second if none are currently there.</span>
<span class="comment">// This should be done periodically, and probably in a separate thread.</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; events = servicePortal.fetchEvents(<span class="integer">1000</span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_transport_orders">2.2. Working with transport orders</h3>
<div class="paragraph">
<p>A transport order, represented by an instance of the class <code>TransportOrder</code>, describes a process to be executed by a vehicle.
Usually, this process is an actual transport of goods from one location to another.
A <code>TransportOrder</code> may, however, also just describe a vehicle&#8217;s movement to a destination position and an optional vehicle operation to be performed.</p>
</div>
<div class="paragraph">
<p>All of the following are examples for "transport orders" in openTCS, even if nothing is actually being transported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A classic order for transporting goods from somewhere to somewhere else:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Move to location "A" and perform operation "Load cargo" there.</p>
</li>
<li>
<p>Move to location "B" and perform operation "Unload cargo" there.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Manipulation of transported or stationary goods:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Move to location "A" and perform operation "Drill" there.</p>
</li>
<li>
<p>Move to location "B" and perform operation "Hammer" there.</p>
</li>
</ol>
</div>
</li>
<li>
<p>An order to move the vehicle to a parking position:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Move to point "Park 01" (without performing any specific operation).</p>
</li>
</ol>
</div>
</li>
<li>
<p>An order to recharge the vehicle&#8217;s battery:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Move to location "Recharge station" and perform operation "Charge battery" there.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_a_transport_orders_life_cycle">2.2.1. A transport order&#8217;s life cycle</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a transport order is created, its initial state is <code>RAW</code>.</p>
</li>
<li>
<p>A user/client sets parameters for the transport order that are supposed to influence the transport process.
These parameters may be e.g. the transport order&#8217;s deadline, the vehicle that is supposed to process the transport order or a set of generic, usually project-specific properties.</p>
</li>
<li>
<p>The transport order is activated, i.e. parameter setup is finished.
Its state is set to <code>ACTIVE</code>.</p>
</li>
<li>
<p>The kernel&#8217;s router checks whether routing between the transport order&#8217;s destinations is possible at all.
If yes, its state is changed to <code>DISPATCHABLE</code>.
If routing is not possible, the transport order is marked as <code>UNROUTABLE</code> and not processed any further.</p>
</li>
<li>
<p>The kernel&#8217;s dispatcher checks whether all requirements for executing the transport order are fulfilled and a vehicle is available for processing it.
As long as there are any requirements not yet fulfilled or no vehicle can execute it, the transport order is left waiting.</p>
</li>
<li>
<p>The kernel&#8217;s dispatcher assigns the transport order to a vehicle for processing.
Its state is changed to <code>BEING_PROCESSED</code>.</p>
<div class="ulist">
<ul>
<li>
<p>If a transport order that is being processed is withdrawn (by a client/user), its state first changes to <code>WITHDRAWN</code> while the vehicle executes any orders that had already been sent to it.
Then the transport order&#8217;s state changes to <code>FAILED</code>.
It is not processed any further.</p>
</li>
<li>
<p>If processing of the transport order fails for any reason, it is marked as <code>FAILED</code> and not processed any further.</p>
</li>
<li>
<p>If the vehicle successfully processes the transport order as a whole, it is marked as <code>FINISHED</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Eventually&#8201;&#8212;&#8201;after a longer while or when too many transport orders in a final state have accumulated in the kernel&#8217;s order pool&#8201;&#8212;&#8201;the kernel removes the transport order.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following state machine visualizes this life cycle:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/transportorder_states.png" alt="transportorder states">
</div>
<div class="title">Figure 4. Transport order states</div>
</div>
</div>
<div class="sect3">
<h4 id="_structure_and_processing_of_transport_orders">2.2.2. Structure and processing of transport orders</h4>
<div class="imageblock">
<div class="content">
<img src="images/transportorder_classes.png" alt="transportorder classes">
</div>
<div class="title">Figure 5. Transport order classes</div>
</div>
<div class="paragraph">
<p>A transport order is created by calling <code>TransportOrderService.createTransportOrder()</code>.
As its parameter, it expects an instance of <code>TransportOrderCreationTO</code> containing the sequence of destinations to visit and the operations a vehicle is supposed to perform there.
The kernel wraps each <code>Destination</code> in a newly-created <code>DriveOrder</code> instance.
These <code>DriveOrder</code>s are themselves wrapped by the kernel in a single, newly-created <code>TransportOrder</code> instance in their given order.</p>
</div>
<div class="paragraph">
<p>Once a <code>TransportOrder</code> is being assigned to a vehicle by the <code>Dispatcher</code>, a <code>Route</code> is computed for each of its <code>DriveOrder</code>s.
These <code>Route</code>s are then stored in the corresponding <code>DriveOrder</code>s.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/transport_order_course.png" alt="transport order course">
</div>
</div>
<div class="paragraph">
<p>As soon as a vehicle (driver) is able to process a <code>DriveOrder</code>, the single <code>Step</code>s of its <code>Route</code> are mapped to <code>MovementCommand</code>s.
These <code>MovementCommand</code>s contain all information the vehicle driver needs to reach the final destination and to perform the desired operation there.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/movementcommand_classes.png" alt="movementcommand classes">
</div>
<div class="title">Figure 6. MovementCommand-related classes</div>
</div>
<div class="paragraph">
<p>The <code>MovementCommand</code>s for the partial routes to be travelled are sent to the vehicle driver bit by bit.
The kernel only sends as many <code>MovementCommands</code>s in advance as is required for the vehicle driver to function properly.
It does this to maintain fine-grained control over the paths/resources used by all vehicles.
A vehicle driver may set the maximum number of <code>MovementCommand</code>s it gets in advance by adjusting its command queue capacity.</p>
</div>
<div class="paragraph">
<p>As soon as a <code>DriveOrder</code> is finished, the <code>Route</code> of the next <code>DriveOrder</code> is mapped to <code>MovementCommand</code>s.
Once the last <code>DriveOrder</code> of a <code>TransportOrder</code> is finished, the whole <code>TransportOrder</code> is finished, as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_create_a_transport_order">2.2.3. How to create a transport order</h4>
<div class="paragraph">
<p>Create a list of destinations the vehicle is supposed to travel to.
Every destination is described by the name of the destination location in the plant model and an operation the vehicle is supposed to perform there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;DestinationCreationTO&gt; destinations
    = <span class="predefined-type">List</span>.of(
        <span class="keyword">new</span> DestinationCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some location</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Some operation</span><span class="delimiter">&quot;</span></span>)
    );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Put as many destinations into the list as necessary.
Then create a transport order description with a name for the new transport order and the list of destinations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderCreationTO orderTO
    = <span class="keyword">new</span> TransportOrderCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyTransportOrder</span><span class="delimiter">&quot;</span></span>, destinations);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, express that the full name of the order should be generated by the kernel.
(If you do not do this, you need to ensure that the name of the transport order given above is unique.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">orderTO = orderTO.withIncompleteName(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, set more parameters for the transport order, e.g. set a deadline for the order or assign a specific vehicle to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">orderTO = orderTO
    .withIntendedVehicleName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some vehicle</span><span class="delimiter">&quot;</span></span>)
    .withDeadline(Instant.now().plus(<span class="integer">1</span>, ChronoUnit.HOURS));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get a <code>TransportOrderService</code> (see <a href="#_acquiring_service_objects">Acquiring service objects</a>) and ask it to create a transport order using the given description:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderService transportOrderService = getATransportOrderService();
transportOrderService.createTransportOrder(orderTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, get a <code>DispatcherService</code> and trigger the kernel&#8217;s dispatcher explicitly to have it check for a vehicle that can process the transport order.
(You only need to do this if you need the dispatcher to be triggered immediately after creating the transport order.
If you do not do this, the dispatcher will still be triggered periodically.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DispatcherService dispatcherService = getADispatcherService();
dispatcherService.dispatch();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_create_a_transport_order_that_sends_a_vehicle_to_a_point_instead_of_a_location">2.2.4. How to create a transport order that sends a vehicle to a point instead of a location</h4>
<div class="paragraph">
<p>Create a list containing a single destination to a point, using <code>Destination.OP_MOVE</code> as the operation to be executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;DestinationCreationTO&gt; destinations
    = <span class="predefined-type">List</span>.of(
        <span class="keyword">new</span> DestinationCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some point</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Destination</span>.OP_MOVE)
    );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a transport order description with a name for the new transport order and the (single-element) list of destinations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderCreationTO orderTO
    = <span class="keyword">new</span> TransportOrderCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyTransportOrder</span><span class="delimiter">&quot;</span></span>, destinations)
        .withIntendedVehicleName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some vehicle</span><span class="delimiter">&quot;</span></span>)
        .withIncompleteName(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get a <code>TransportOrderService</code> (see <a href="#_acquiring_service_objects">Acquiring service objects</a>) and ask it to create a transport order using the given description:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderService transportOrderService = getATransportOrderService();
transportOrderService.createTransportOrder(orderTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, get a <code>DispatcherService</code> and trigger the kernel&#8217;s dispatcher explicitly to have it check for a vehicle that can process the transport order.
(You only need to do this if you need the dispatcher to be triggered immediately after creating the transport order.
If you do not do this, the dispatcher will still be triggered periodically.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DispatcherService dispatcherService = getADispatcherService();
dispatcherService.dispatch();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_work_with_order_sequences">2.2.5. How to work with order sequences</h4>
<div class="paragraph">
<p>An order sequence can be used to force a single vehicle to process multiple transport orders in a given order.
Some rules for using order sequences are described in the API documentation for <code>OrderSequence</code>, but here is what you would do in general.
First, create an order sequence description, providing a name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">OrderSequenceCreationTO sequenceTO
    = <span class="keyword">new</span> OrderSequenceCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyOrderSequence</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, express that the full name of the sequence should be generated by the kernel.
(If you do not do this, you need to ensure that the name of the order sequence given above is unique.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sequenceTO = sequenceTO.withIncompleteName(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, set the sequence&#8217;s failure-fatal flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sequenceTO = sequenceTO.withFailureFatal(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get a <code>TransportOrderService</code> (see <a href="#_acquiring_service_objects">Acquiring service objects</a>) and ask it to create an order sequence using the given description:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderService transportOrderService = getATransportOrderService();
OrderSequence orderSequence
    = transportOrderService.createOrderSequence(sequenceTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a description for the transport order as usual, but set the wrapping sequence&#8217;s name via <code>withWrappingSequence()</code> to associate the transport order with the order sequence.
Then, create the transport order using the <code>TransportOrderService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrderCreationTO orderTO
    = <span class="keyword">new</span> TransportOrderCreationTO(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MyOrder</span><span class="delimiter">&quot;</span></span>,
        <span class="predefined-type">List</span>.of(
            <span class="keyword">new</span> DestinationCreationTO(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some location</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Some operation</span><span class="delimiter">&quot;</span></span>)
        )
    )
        .withIncompleteName(<span class="predefined-constant">true</span>)
        .withWrappingSequence(orderSequence.getName());

transportOrderService.createTransportOrder(orderTO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create and add more orders to the order sequence as necessary.
Eventually, set the order sequence&#8217;s <em>complete</em> flag to indicate that no further transport orders will be added to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">transportOrderService.markOrderSequenceComplete(
    orderSequence.getReference()
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As long as the sequence has not been marked as complete and finished completely, the vehicle selected for its first order will be tied to this sequence.
It will not process any orders not belonging to the same sequence until the whole sequence has been finished.</p>
</div>
<div class="paragraph">
<p>Once the <em>complete</em> flag of the sequence has been set and all transport orders belonging to it have been processed, its <em>finished</em> flag will be set by the kernel.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_withdraw_a_transport_order">2.2.6. How to withdraw a transport order</h4>
<div class="paragraph">
<p>To withdraw a transport order, get a <code>DispatcherService</code> (see <a href="#_acquiring_service_objects">Acquiring service objects</a>) and ask it to withdraw the order, providing a reference to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DispatcherService dispatcherService = getADispatcherService();
dispatcherService.withdrawByTransportOrder(someOrder.getReference(), <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second argument indicates whether the vehicle should finish the movements it is already assigned to (<code>false</code>) or abort immediately (<code>true</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_withdraw_a_transport_order_via_a_vehicle_reference">2.2.7. How to withdraw a transport order via a vehicle reference</h4>
<div class="paragraph">
<p>To withdraw the transport order that a specific vehicle is currently processing, get a <code>DispatcherService</code> (see <a href="#_acquiring_service_objects">Acquiring service objects</a>) and ask it to withdraw the order, providing a reference to the vehicle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DispatcherService dispatcherService = getADispatcherService();
dispatcherService.withdrawByVehicle(curVehicle.getReference(), <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second argument indicates whether the vehicle should finish the movements it is already assigned to (<code>false</code>) or abort immediately (<code>true</code>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_event_bus">2.3. Using the event bus</h3>
<div class="paragraph">
<p>Each of the main openTCS applications&#8201;&#8212;&#8201;Kernel, Kernel Control Center, Model Editor and Operations Desk&#8201;&#8212;&#8201;provides an event bus that can be used to receive or emit event objects application-wide.
To acquire the respective application&#8217;s event bus instance, request it to be provided via dependency injection.
Any of the following three variants of constructor parameters are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyClass(<span class="annotation">@ApplicationEventBus</span> <span class="predefined-type">EventHandler</span> eventHandler) {
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyClass(<span class="annotation">@ApplicationEventBus</span> EventSource eventSource) {
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyClass(<span class="annotation">@ApplicationEventBus</span> EventBus eventBus) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having acquired the <code>EventHandler</code>, <code>EventSource</code> or <code>EventBus</code> instance that way, you can use it to emit event objects to it and/or subscribe to receive event objects.</p>
</div>
<div class="paragraph">
<p>Note that, within the Kernel application, event objects should be emitted via the kernel executor to avoid concurrency issues&#8201;&#8212;&#8201;see <a href="#section-kernel-executor">Executing code in kernel context</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_an_integration_project">3. Generating an integration project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openTCS integration projects for customer- or plant-specific distributions often have a very similar structure.
The openTCS distribution provides a way to easily generate such integration projects.
This way, a developer can get started with customizing and extending openTCS components quickly.</p>
</div>
<div class="paragraph">
<p>To generate a template/skeleton for a new integration project, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unzip the integration project example from the openTCS homepage.</p>
</li>
<li>
<p>Execute the following command from the example project&#8217;s root directory:
<code>gradlew cloneProject</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The integration project will be generated in the <code>build/</code> directory.
(Make sure you copy it somewhere else before running the example project&#8217;s <code>clean</code> task the next time.)</p>
</div>
<div class="paragraph">
<p>The project and the included classes will have generic names.
You can adjust their names by setting a couple of properties when running the above command.
The following properties are looked at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>integrationName</em>:
Used for the names of the project itself and the subprojects within it.</p>
</li>
<li>
<p><em>classPrefix</em>:
Used for some classes within the subprojects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For instance, your command line could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">gradlew -PintegrationName=MyGreatProject -PclassPrefix=Great cloneProject</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would include <em>MyGreatProject</em> in the integration project name, and <em>Great</em> in some class names.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Inserting your own source code into a copy of the baseline openTCS project instead of creating a proper integration project as described above is not recommended.
This is because, when integrating openTCS by copying its source code, you lose the ability to easily upgrade your code to more recent openTCS versions (for bugfixes or new features).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_and_extending_the_kernel_application">4. Customizing and extending the kernel application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_guice_modules">4.1. Guice modules</h3>
<div class="paragraph">
<p>The openTCS kernel application uses Guice to configure its components.
To modify the wiring of components within the application and to add your own components, you can register custom Guice modules.
Modules are found and registered automatically via <code>java.util.ServiceLoader</code>.</p>
</div>
<div class="paragraph">
<p>Basically, the following steps are required for customizing the application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build a JAR file for your custom injection module with the following content:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A subclass of <code>org.opentcs.customizations.kernel.KernelInjectionModule</code>, which can be found in the base library, must be contained.
Configure your custom components or adjust the application&#8217;s default wiring in this module.
<code>KernelInjectionModule</code> provides a few supporting methods you can use.</p>
</li>
<li>
<p>A plain text file named <code>META-INF/services/org.opentcs.customizations.kernel.KernelInjectionModule</code> must also be contained.
This file should contain a single line of text with the fully qualified class name of your module.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ensure that the JAR file(s) containing your Guice modules and the implementation of your custom component(s) are part of the class path when you start the kernel application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on how the automatic registration works, see the documentation of <code>java.util.ServiceLoader</code> in the Java class library.
For more information on how Guice works, see the Guice documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_replacing_default_kernel_components">4.2. Replacing default kernel components</h3>
<div class="paragraph">
<p>The kernel application comes with default implementations for the dispatching, routing and scheduling components.
These default implementations allow the kernel to fulfil all of its responsibilities, but specific use cases might make it necessary to replace them with custom ones.
In such cases, they can be replaced with a custom Guice configuration.</p>
</div>
<div class="paragraph">
<p>For each of these components, <code>KernelInjectionModule</code> provides a convenience method for (re)binding the implementation.
To replace e.g. the default <code>Dispatcher</code> implementation, simply register a Guice module in which you call <code>bindDispatcher()</code>.
The module&#8217;s implementation could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> configure() {
  configureSomeDispatcherDependencies();
  bindDispatcher(CustomDispatcher.class);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that all component implementations are bound as singletons.
This is important for the following reason:
Components may be injected and used at multiple places within the kernel application; at the same time, every component may also have to keep an internal state to do its work.
If they were not bound as singletons, a new instance would be created for every injection, each of them with their own, separate internal state.
Build custom components with that in mind, and implement their <code>initialize()</code> and <code>terminate()</code> methods appropriately!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_developing_vehicle_drivers">4.3. Developing vehicle drivers</h3>
<div class="paragraph">
<p>openTCS supports integration of custom vehicle drivers that implement vehicle-specific communication protocols and thus mediate between the kernel and the vehicle.
Due to its function, a vehicle driver is also called a communication adapter.
The following sections describe which requirements must be met by a driver and which steps are necessary to create and use it.</p>
</div>
<div class="sect3">
<h4 id="_classes_and_interfaces_for_the_kernel">4.3.1. Classes and interfaces for the kernel</h4>
<div class="imageblock">
<div class="content">
<img src="images/commadapter_classes_kernel.png" alt="commadapter classes kernel">
</div>
<div class="title">Figure 7. Classes of a comm adapter implementation (kernel side)</div>
</div>
<div class="paragraph">
<p>When developing a vehicle driver, the most important classes and interfaces in the base library are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VehicleCommAdapter</code> declares methods that every comm adapter must implement.
These methods are called by components within the kernel, for instance to tell a vehicle that it is supposed to move to the next position in the driving course.
Classes implementing this interface are expected to perform the actual communication with a vehicle, e.g. via TCP, UDP or some field bus.</p>
</li>
<li>
<p><code>BasicVehicleCommAdapter</code> is the recommended base class for implementing a <code>VehicleCommAdapter</code>.
It primarily provides some basic command queueing.</p>
</li>
<li>
<p><code>VehicleCommAdapterFactory</code> describes a factory for <code>VehicleCommAdapter</code> instances.
The kernel instantiates and uses one such factory per vehicle driver to create instances of the respective <code>VehicleCommAdapter</code> implementation on demand.</p>
</li>
<li>
<p>A single <code>VehicleProcessModel</code> instance should be provided by every <code>VehicleCommAdapter</code> instance in which it keeps the relevant state of both the vehicle and the comm adapter.
This model instance is supposed to be updated to notify the kernel about relevant changes.
The comm adapter implementation should e.g. update the vehicle&#8217;s current position in the model when it receives that information to allow the kernel and GUI frontends to use it.
Likewise, other components may set values that influence the comm adapter&#8217;s behaviour in the model, e.g. a time interval for periodic messages the comm adapter sends to the vehicle.
<code>VehicleProcessModel</code> may be used as it is, as it contains members for all the information the openTCS kernel itself needs.
However, developers may use driver-specific subclasses of <code>VehicleProcessModel</code> to have the comm adapter and other components exchange more than the default set of attributes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_classes_and_interfaces_for_the_control_center_application">4.3.2. Classes and interfaces for the control center application</h4>
<div class="paragraph">
<p>For the kernel control center application, the following interfaces and classes are the most important ones:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/commadapter_classes_kcc.png" alt="commadapter classes kcc">
</div>
<div class="title">Figure 8. Classes of a comm adapter implementation (kernel control center side)</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VehicleCommAdapterPanel</code> instances may be created by a <code>VehicleCommAdapterPanelFactory</code> e.g. to display information about the associated vehicle or send low-level messages to it.</p>
</li>
<li>
<p><code>VehicleProcessModelTO</code> instances should be provided by every <code>VehicleCommAdapter</code> instance according to the current state of its <code>VehicleProcessModel</code>.
Instances of this model are supposed to be used in a comm adapter&#8217;s <code>VehicleCommAdapterPanel</code> instances for updating their contents only.
Note that <code>VehicleProcessModelTO</code> is basically a serializable representation of a comm adapter&#8217;s <code>VehicleProcessModel</code>.
Developers should keep that in mind when creating driver-specific subclasses of <code>VehicleProcessModelTO</code>.</p>
</li>
<li>
<p>Instances of <code>VehicleCommAdapterDescription</code> provide a string describing/identifying the comm adapter implementation.
This string is shown e.g. when the user may select one of a set of driver implementations and should thus be unique.
It is also used for attaching a comm adapter implementation via <code>VehicleService.attachCommAdapter()</code>.</p>
</li>
<li>
<p><code>AdapterCommand</code> instances can be sent from a panel to a <code>VehicleCommAdapter</code> instance via <code>VehicleService.sendCommAdapterCommand()</code>.
They are supposed to be executed by the comm adapter and can be used to execute arbitrary methods, e.g. methods of the <code>VehicleCommAdapter</code> itself, or update contents of the comm adapter&#8217;s <code>VehicleProcessModel</code>.
Note that <code>AdapterCommand</code> instances can only be sent to and processed by the kernel application if they are serializable and present in the kernel application&#8217;s classpath.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_steps_to_create_a_new_vehicle_driver">4.3.3. Steps to create a new vehicle driver</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an implementation of <code>VehicleCommAdapter</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Subclass <code>BasicVehicleCommAdapter</code> unless you have a reason not to.
You don&#8217;t have to, but if you don&#8217;t, you also need to implement command queue management yourself.</p>
</li>
<li>
<p>Implement the abstract methods of <code>BasicVehicleCommAdapter</code> in the derived class to realize communication with the vehicle.</p>
</li>
<li>
<p>In situations in which the state of the vehicle changes in a way that is relevant for the kernel or the comm adapter&#8217;s custom panels, the comm adapter should call the respective methods on the model.
Most importantly, call <code>setVehiclePosition()</code> and <code>commandExecuted()</code> on the comm adapter&#8217;s model when the controlled vehicle&#8217;s reported state indicates that it has moved to a different position or that it has finished an order.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create an implementation of <code>VehicleCommAdapterFactory</code> that provides instances of your <code>VehicleCommAdapter</code> for given <code>Vehicle</code> objects.</p>
</li>
<li>
<p>Optional: Create any number of implementations of <code>VehicleCommAdapterPanel</code> that the kernel control center application should display for the comm adapter.
Create and return instances of these panels in the <code>getPanelsFor()</code> method of your <code>VehicleCommAdapterPanelFactory</code>s implementation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See the API documentation for more details.
For an example, refer to the implementation of the loopback comm adapter for virtual vehicles in the openTCS source distribution.
(Note, however, that this implementation does not implement communication with any physical vehicle.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_a_vehicle_driver_with_the_kernel">4.3.4. Registering a vehicle driver with the kernel</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Guice module for your vehicle driver by creating a subclass of <code>KernelInjectionModule</code>.
Implement the <code>configure()</code> method and register a binding to your <code>VehicleCommAdapterFactory</code>.
For example, the loopback driver that is part of the openTCS distribution registers its own factory class with the following line in its <code>configure()</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    vehicleCommAdaptersBinder().addBinding().to(LoopbackCommunicationAdapterFactory.class);</code></pre>
</div>
</div>
</li>
<li>
<p>In the JAR file containing your driver, ensure that there exists a folder named <code>META-INF/services/</code> with a file named <code>org.opentcs.customizations.kernel.KernelInjectionModule</code>.
This file should consist of a single line of text holding simply the name of the Guice module class, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.opentcs.virtualvehicle.LoopbackCommAdapterModule</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Background: openTCS uses <code>java.util.ServiceLoader</code> to automatically find Guice modules on startup, which depends on this file (with this name) being present.
See the JDK&#8217;s API documentation for more information about how this mechanism works.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Place the JAR file of your driver including all neccessary resources in the subdirectory <code>lib/openTCS-extensions/</code> of the openTCS kernel application&#8217;s installation directory <em>before</em> the kernel is started.
(The openTCS start scripts include all JAR files in that directory in the application&#8217;s classpath.)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Drivers meeting these requirements are found automatically when you start the kernel.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_messages_to_communication_adapters">4.4. Sending messages to communication adapters</h3>
<div class="paragraph">
<p>Sometimes it is required to have some influence on the behaviour of a communication adapter (and thus the vehicle it is associated with) directly from a kernel client - to send a special telegram to the vehicle, for instance.
For these cases, <code>VehicleService.sendCommAdapterMessage(TCSObjectReference&lt;Vehicle&gt;, Object)</code> provides a one-way communication channel for a client to send a message object to a communication adapter currently associated with a vehicle.
A comm adapter implementing <code>processMessage()</code> may interpret message objects sent to it and react in an appropriate way.
Note that the client sending the message may not know which communication adapter implementation is currently associated with the vehicle, so the adapter may or may not be able to understand the message.</p>
</div>
</div>
<div class="sect2">
<h3 id="_acquiring_data_from_communication_adapters">4.5. Acquiring data from communication adapters</h3>
<div class="paragraph">
<p>For getting information from a communication adapter to a kernel client, there are the following ways:</p>
</div>
<div class="paragraph">
<p>Communication adapters may publish events via their <code>VehicleProcessModel</code> instance to emit information encapsulated in an event for any listeners registered with the kernel.
Apparently, listeners must already be registered before such an event is emitted by the communication adapter, or they will miss it.
To register a client as a listener, use <code>EventSource.subscribe()</code>.
You can get the <code>EventSource</code> instance used by the kernel through dependency injection by using the qualifier annotation <code>ApplicationEventBus</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, communication adapters may use their <code>VehicleProcessModel</code> to set properties in the corresponding <code>Vehicle</code> object.
Kernel clients may then retrieve the information from it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Vehicle vehicle = getSomeVehicle();
<span class="predefined-type">String</span> value = vehicle.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>);
processPropertyValue(value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Communication adapters may also use their <code>VehicleProcessModel</code> to set properties in the corresponding <code>TransportOrder</code> object a vehicle is currently processing.
This basically works the same way as with the <code>Vehicle</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TransportOrder transportOrder = getSomeTransportOrder();
<span class="predefined-type">String</span> value = transportOrder.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>);
processPropertyValue(value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike information published via events, data stored as properties in <code>Vehicle</code> or <code>TransportOrder</code> objects can be retrieved at any time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_developing_peripheral_drivers">4.6. Developing peripheral drivers</h3>
<div class="paragraph">
<p>In addition to vehicle drivers, openTCS supports the integration of custom peripheral drivers that implement peripheral-specific communication protocols and thus mediate between the kernel and the peripheral device.
In openTCS, a peripheral device is a device a vehicle may interact with along its route, e.g. an elevator or a fire door.
Due to its function, a peripheral driver is also called a peripheral communication adapter.
The following sections describe which requirements must be met by a driver and which steps are necessary to create and use it.</p>
</div>
<div class="sect3">
<h4 id="_classes_and_interfaces_for_the_kernel_2">4.6.1. Classes and interfaces for the kernel</h4>
<div class="imageblock">
<div class="content">
<img src="images/peripheral_commadapter_classes_kernel.png" alt="peripheral commadapter classes kernel">
</div>
<div class="title">Figure 9. Classes of a peripheral comm adapter implementation (kernel side)</div>
</div>
<div class="paragraph">
<p>When developing a peripheral driver, the most important classes and interfaces in the base library are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PeripheralCommAdapter</code> declares methods that every comm adapter must implement.
These methods are called by components within the kernel, for instance to tell a peripheral device that it is supposed to perform an operation, e.g. for an elevator to move to a specific floor.
Classes implementing this interface are expected to perform the actual communication with a peripheral device, e.g. via TCP, UDP or some field bus.</p>
</li>
<li>
<p><code>BasicPeripheralCommAdapter</code> is the recommended base class for implementing a <code>PeripheralCommAdapter</code>.
It primarily provides some basic event dispatching with regards to the <code>PeripheralProcessModel</code>.</p>
</li>
<li>
<p><code>PeripheralCommAdapterFactory</code> describes a factory for <code>PeripheralCommAdapter</code> instances.
The kernel instantiates and uses one such factory per peripheral driver to create instances of the respective <code>PeripheralCommAdapter</code> implementation on demand.</p>
</li>
<li>
<p>A single <code>PeripheralProcessModel</code> instance should be provided by every <code>PeripheralCommAdapter</code> instance in which it keeps the relevant state of both the peripheral device and the comm adapter.
This model instance is supposed to be updated to notify the kernel about relevant changes.
The comm adapter implementation should e.g. update the peripheral device&#8217;s current state in the model when it receives that information to allow the kernel and GUI frontends to use it.
<code>PeripheralProcessModel</code> may be used as it is, as it contains members for all the information the openTCS kernel itself needs.
However, developers may use driver-specific subclasses of <code>PeripheralProcessModel</code> to have the comm adapter and other components exchange more than the default set of attributes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_classes_and_interfaces_for_the_control_center_application_2">4.6.2. Classes and interfaces for the control center application</h4>
<div class="paragraph">
<p>For the kernel control center application, the following classes and interfaces are the most important:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/peripheral_commadapter_classes_kcc.png" alt="peripheral commadapter classes kcc">
</div>
<div class="title">Figure 10. Classes of a peripheral comm adapter implementation (kernel control center side)</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PeripheralCommAdapterPanel</code> instances may be created by a <code>PeripheralCommAdapterPanelFactory</code> e.g. to display information about the associated peripheral device or send low-level messages to it.</p>
</li>
<li>
<p><code>PeripheralProcessModel</code> instances are used in a comm adapter&#8217;s <code>PeripheralCommAdapterPanel</code> instances for updating their contents.
In contrast to a <code>VehicleCommAdapter</code>, there is no class such as <code>PeripheralProcessModelTO</code>, since <code>PeripheralProcessModel</code> already implements the <code>Serializable</code> interface.
Developers should keep that in mind when creating driver-specific subclasses of <code>PeripheralProcessModel</code>.</p>
</li>
<li>
<p>Instances of <code>PeripheralCommAdapterDescription</code> provide a string describing/identifying the comm adapter implementation.
This string is shown e.g. when the user may select one of a set of driver implementations and should thus be unique.
It is also used for attaching a comm adapter implementation via <code>PeripheralService.attachCommAdapter()</code>.</p>
</li>
<li>
<p><code>PeripheralAdapterCommand</code> instances can be sent from a panel to a <code>PeripheralCommAdapter</code> instance via <code>PeripheralService.sendCommAdapterCommand()</code>.
They are supposed to be executed by the comm adapter and can be used to execute arbitrary methods, e.g. methods of the <code>PeripheralCommAdapter</code> itself, or update contents of the comm adapter&#8217;s <code>PeripheralProcessModel</code>.
Note that <code>PeripheralAdapterCommand</code> instances can only be sent to and processed by the kernel application if they are serializable and present in the kernel application&#8217;s classpath.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_steps_to_create_a_new_peripheral_driver">4.6.3. Steps to create a new peripheral driver</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an implementation of <code>PeripheralCommAdapter</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Subclass <code>BasicPeripheralCommAdapter</code> unless you have a reason not to.</p>
</li>
<li>
<p>Implement the abstract methods of <code>BasicPeripheralCommAdapter</code> in the derived class to realize communication with the peripheral device.</p>
</li>
<li>
<p>In situations in which the state of the peripheral device changes in a way that is relevant for the kernel or the comm adapter&#8217;s custom panels, the comm adapter should call the respective methods on the model and publish a corresponding <code>PeripheralProcessModelEvent</code> via the kernel&#8217;s <code>ApplicationEventBus</code>.
Most importantly, call <code>PeripheralJobCallback.peripheralJobFinished()</code> on the callback instance provided with <code>PeripheralCommAdapter.process()</code> when the controlled peripheral device&#8217;s reported state indicates that it has finished a job.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create an implementation of <code>PeripheralCommAdapterFactory</code> that provides instances of your <code>PeripheralCommAdapter</code> for given <code>Location</code> objects.</p>
</li>
<li>
<p>Optional: Create any number of implementations of <code>PeripheralCommAdapterPanel</code> that the kernel control center application should display for the comm adapter.
Create and return instances of these panels in the <code>getPanelsFor()</code> method of your <code>PeripheralCommAdapterPanelFactory</code>s implementation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See the API documentation for more details.
For an example, refer to the implementation of the loopback peripheral comm adapter for virtual peripheral devices in the openTCS source distribution.
(Note, however, that this implementation does not implement communication with any physical peripheral device.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_a_peripheral_driver_with_the_kernel">4.6.4. Registering a peripheral driver with the kernel</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Guice module for your peripheral driver by creating a subclass of <code>KernelInjectionModule</code>.
Implement the <code>configure()</code> method and register a binding to your <code>PeripheralCommAdapterFactory</code>.
For example, the peripheral loopback driver that is part of the openTCS distribution registers its own factory class with the following line in its <code>configure()</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    peripheralCommAdaptersBinder().addBinding().to(LoopbackPeripheralCommAdapterFactory.class);</code></pre>
</div>
</div>
</li>
<li>
<p>In the JAR file containing your driver, ensure that there exists a folder named <code>META-INF/services/</code> with a file named <code>org.opentcs.customizations.kernel.KernelInjectionModule</code>.
This file should consist of a single line of text holding simply the name of the Guice module class, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.opentcs.commadapter.peripheral.loopback.LoopbackPeripheralKernelModule</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Background: openTCS uses <code>java.util.ServiceLoader</code> to automatically find Guice modules on startup, which depends on this file (with this name) being present.
See the JDK&#8217;s API documentation for more information about how this mechanism works.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Place the JAR file of your driver including all neccessary resources in the subdirectory <code>lib/openTCS-extensions/</code> of the openTCS kernel application&#8217;s installation directory <em>before</em> the kernel is started.
(The openTCS start scripts include all JAR files in that directory in the application&#8217;s classpath.)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Drivers meeting these requirements are found automatically when you start the kernel.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-kernel-executor">4.7. Executing code in kernel context</h3>
<div class="paragraph">
<p>Within the kernel, concurrent modifications of the data model&#8201;&#8212;&#8201;e.g. contents of the plant model or transport order properties&#8201;&#8212;&#8201;need to be synchronized carefully.
Similar to e.g. the Swing framework&#8217;s Event Dispatcher Thread, a single thread is used for executing one-shot or periodics tasks performing data modifications.
To help with this, an instance of <code>java.util.concurrent.ScheduledExecutorService</code> is provided.
Custom code running within the kernel application, including vehicle drivers and implementations of additional funcionality, should also perform changes of the data model via this executor only to avoid concurrency issues.</p>
</div>
<div class="paragraph">
<p>To make use of the kernel&#8217;s executor, use the <code>@KernelExecutor</code> qualifier annotation and inject a <code>ScheduledExecutorService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">public</span> MyClass(<span class="annotation">@KernelExecutor</span> <span class="predefined-type">ScheduledExecutorService</span> kernelExecutor) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also inject it as a <code>java.util.concurrent.ExecutorService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">public</span> MyClass(<span class="annotation">@KernelExecutor</span> <span class="predefined-type">ExecutorService</span> kernelExecutor) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Injecting a <code>java.util.concurrent.Executor</code> is also possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">public</span> MyClass(<span class="annotation">@KernelExecutor</span> <span class="predefined-type">Executor</span> kernelExecutor) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you can use it e.g. to lock a path in the plant model in kernel context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">kernelExecutor.submit(() -&gt; routerService.updatePathLock(ref, <span class="predefined-constant">true</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to the single-threaded nature of the kernel executor, tasks submitted to it are executed sequentially, one after another.
This implies that submitting long-running tasks should be avoided, as they would block the execution of subsequent tasks.</p>
</div>
<div class="paragraph">
<p>When event objects, e.g. instances of <code>TCSObjectEvent</code>, are distributed within the kernel, this always happens in kernel context, i.e. from a task that is run by the kernel executor.
Event handlers should behave accordingly and finish quickly/not block execution for too long.
If processing an event requires time-consuming actions to be taken, these should be executed on a different thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As its name indicates, the kernel executor is only available within the kernel application.
It is not available for code running in other applications like the Operations Desk, and it is not required there (for avoiding concurrency issues in the kernel).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_and_extending_the_control_center_application">5. Customizing and extending the control center application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_guice_modules_2">5.1. Guice modules</h3>
<div class="paragraph">
<p>The openTCS kernel control center application uses Guice to configure its components.
To modify the wiring of components within the application and to add your own components, you can register custom Guice modules.
Modules are found and registered automatically via <code>java.util.ServiceLoader</code>.</p>
</div>
<div class="paragraph">
<p>Basically, the following steps are required for customizing the application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build a JAR file for your custom injection module with the following content:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A subclass of <code>org.opentcs.customizations.controlcenter.ControlCenterInjectionModule</code> must be contained.
Configure your custom components or adjust the application&#8217;s default wiring in this module.
<code>ControlCenterInjectionModule</code> provides a few supporting methods you can use.</p>
</li>
<li>
<p>A plain text file named <code>META-INF/services/org.opentcs.customizations.controlcenter.ControlCenterInjectionModule</code> must also be contained.
This file should contain a single line of text with the fully qualified class name of your module.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ensure that the JAR file(s) containing your Guice modules and the implementation of your custom component(s) are part of the class path when you start the control center application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on how the automatic registration works, see the documentation of <code>java.util.ServiceLoader</code> in the Java class library.
For more information on how Guice works, see the Guice documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_driver_panels_with_the_control_center">5.2. Registering driver panels with the control center</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Guice module for your vehicle driver by creating a subclass of <code>ControlCenterInjectionModule</code>.
Implement the <code>configure()</code> method and register a binding to your <code>VehicleCommAdapterPanelFactory</code>.
The following example demonstrates how this module&#8217;s <code>configure()</code> method looks like for the loopback driver that is part of the openTCS distribution:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Override</span>
  <span class="directive">protected</span> <span class="type">void</span> configure() {
    commAdapterPanelFactoryBinder().addBinding().to(LoopbackCommAdapterPanelFactory.class);
  }</code></pre>
</div>
</div>
</li>
<li>
<p>In the JAR file containing your driver, ensure that there exists a folder named <code>META-INF/services/</code> with a file named <code>org.opentcs.customizations.controlcenter.ControlCenterInjectionModule</code>.
This file should consist of a single line of text holding simply the name of the Guice module class, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.opentcs.controlcenter.LoopbackCommAdapterPanelsModule</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Background: openTCS uses <code>java.util.ServiceLoader</code> to automatically find Guice modules on startup, which depends on this file (with this name) being present.
See the JDK&#8217;s API documentation for more information about how this mechanism works.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Place the JAR file of your driver including all neccessary resources in the subdirectory <code>lib/openTCS-extensions/</code> of the control center application&#8217;s installation directory <em>before</em> the application is started.
(The openTCS start scripts include all JAR files in that directory in the application&#8217;s classpath.)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Panels meeting these requirements are found automatically when you start the kernel control center application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_and_extending_the_model_editor_and_the_operations_desk_applications">6. Customizing and extending the Model Editor and the Operations Desk applications</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The process of customizing and extending the Model Editor and the Operations Desk is basically identical for both applications.
For the sake of simplicity, this section describes the process using the Operations Desk application as an example.
Where necessary, differences between the two applications are explicitly mentioned.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_guice_modules_3">6.1. Guice modules</h3>
<div class="paragraph">
<p>Analogous to the kernel application, the Operations Desk application uses Guice to configure its components.
To modify the wiring of components within the application and to add your own components, you can register custom Guice modules.
Modules are found and registered automatically via <code>java.util.ServiceLoader</code>.</p>
</div>
<div class="paragraph">
<p>Basically, the following steps are required for customizing the application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build a JAR file for your custom injection module with the following content:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A subclass of <code>PlantOverviewInjectionModule</code>, which can be found in the base library, must be contained.
Configure your custom components or adjust the application&#8217;s default wiring in this module.
<code>PlantOverviewInjectionModule</code> provides a few supporting methods you can use.</p>
</li>
<li>
<p>A plain text file named <code>META-INF/services/org.opentcs.customizations.plantoverview.PlantOverviewInjectionModule</code> must also be contained.
This file should contain a single line of text with the fully qualified class name of your module.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ensure that the JAR file(s) containing your Guice modules and the implementation of your custom component(s) are part of the class path when you start the Operations Desk application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on how the automatic registration works, see the documentation of <code>java.util.ServiceLoader</code> in the Java class library.
For more information on how Guice works, see the Guice documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_add_importexport_functionality_for_plant_model_data">6.2. How to add import/export functionality for plant model data</h3>
<div class="paragraph">
<p>It is not uncommon for plant model data to be shared with other systems.
For instance, it is possible that the navigation computer of a vehicle already has detailed information about the plant environment such as important positions and connections between them.
Entering this data manually via the Model Editor application would be a tiresome and error-prone work.
To help relieve users from such work, the Model Editor supports integrating components for importing plant model data from external resources&#8201;&#8212;&#8201;e.g. files in a foreign file format&#8201;&#8212;&#8201;or exporting plant model data to such resources.</p>
</div>
<div class="paragraph">
<p>To integrate a model import component, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a class that implements the interface <code>PlantModelImporter</code> and implement the methods declared by it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In <code>importPlantModel()</code>, implement what is necessary to produce an instance of <code>PlantModelCreationTO</code> that describes the plant model.
The actual steps necessary here may vary depending on the source and the type of model data to be imported.
In most cases, however, the process will probably look like the following:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Show a dialog for the user to select the file to be imported.</p>
</li>
<li>
<p>Parse the content of the selected file according to its specific file format.</p>
</li>
<li>
<p>Convert the parsed model data to instances of <code>PointCreationTO</code>, <code>PathCreationTO</code> etc., and fill a newly created <code>PlantModelCreationTO</code> instance with them.</p>
</li>
<li>
<p>Return the <code>PlantModelCreationTO</code> instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p><code>getDescription()</code> should return a short description for your importer, for instance "Import from XYZ course data file".
An entry with this text will be shown in the Model Editor&#8217;s <b class="button"><span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import plant model</b></b></span> submenu, and clicking on this entry will result in your <code>importPlantModel()</code> implementation to be called.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a Guice module for registering your <code>PlantModelImporter</code> with openTCS by subclassing <code>PlantOverviewInjectionModule</code>.
Implement the <code>configure()</code> method and add a binding to your <code>PlantModelImporter</code> using <code>plantModelImporterBinder()</code>.</p>
</li>
<li>
<p>Build and package the <code>PlantModelImporter</code> and Guice module into a JAR file.</p>
</li>
<li>
<p>In the JAR file, register the Guice module class as a service of type <code>PlantOverviewInjectionModule</code>.
To do that, ensure that the JAR file contains a folder named <code>META-INF/services/</code> with a file named <code>org.opentcs.customizations.plantoverview.PlantOverviewInjectionModule</code>.
This file should consist of a single line of text holding simply the name of the Guice module class.
(See <a href="#_how_to_create_a_plugin_panel_for_the_operations_desk_client">How to create a plugin panel for the Operations Desk client</a> for an example.)</p>
</li>
<li>
<p>Place the JAR file in the Model Editor application&#8217;s class path (subdirectory <code>lib/openTCS-extensions/</code> of the application&#8217;s installation directory) and start the application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To integrate a model <em>export</em> component, you follow the same steps, but implement the interface <code>PlantModelExporter</code> instead of <code>PlantModelImporter</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_create_a_plugin_panel_for_the_operations_desk_client">6.3. How to create a plugin panel for the Operations Desk client</h3>
<div class="paragraph">
<p>The Operations Desk client offers to integrate custom panels providing project-specific functionality.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement a subclass of <code>PluggablePanel</code>.</p>
</li>
<li>
<p>Implement a <code>PluggablePanelFactory</code> that produces instances of your <code>PluggablePanel</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>PluggablePanelFactory.providesPanel(state)</code> method is used to determine which <code>Kernel.State</code> a factory provides panels for.
For plugin panels that are intended to be used with the Model Editor application only, this method should return <code>true</code> for the kernel state <code>Kernel.State.MODELLING</code>.
For plugin panels that are intended to be used with the Operations Desk application only, this method should return <code>true</code> for the kernel state <code>Kernel.State.OPERATING</code>.
Otherwise the plugin panels won&#8217;t be shown in the respective application.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a Guice module for your <code>PluggablePanelFactory</code> by subclassing <code>PlantOverviewInjectionModule</code>.
Implement the <code>configure()</code> method and add a binding to your <code>PluggablePanelFactory</code> using <code>pluggablePanelFactoryBinder()</code>.
For example, the load generator panel that is part of the openTCS distribution is registered with the following line in its module&#8217;s <code>configure()</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    pluggablePanelFactoryBinder().addBinding().to(ContinuousLoadPanelFactory.class);</code></pre>
</div>
</div>
</li>
<li>
<p>Build and package the <code>PluggablePanel</code>, <code>PluggablePanelFactory</code> and Guice module into a JAR file.</p>
</li>
<li>
<p>In the JAR file, register the Guice module class as a service of type <code>PlantOverviewInjectionModule</code>.
To do that, ensure that the JAR file contains a folder named <code>META-INF/services/</code> with a file named <code>org.opentcs.customizations.plantoverview.PlantOverviewInjectionModule</code>.
This file should consist of a single line of text holding simply the name of the Guice module class, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.opentcs.guing.plugins.panels.loadgenerator.LoadGeneratorPanelModule</code></pre>
</div>
</div>
</li>
<li>
<p>Place the JAR file in the Operations Desk application&#8217;s class path (subdirectory <code>lib/openTCS-extensions/</code> of the application&#8217;s installation directory) and start the application.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_create_a_locationvehicle_theme_for_opentcs">6.4. How to create a location/vehicle theme for openTCS</h3>
<div class="paragraph">
<p>Locations and vehicles are visualized in the Operations Desk client using configurable themes.
To customize the appearance of locations and vehicles, new theme implementations can be created and integrated into the Operations Desk client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new class which implements <code>LocationTheme</code> or <code>VehicleTheme</code>.</p>
</li>
<li>
<p>Place the JAR file of your theme, containing all required resources, in the subdirectory <code>lib/openTCS-extensions/</code> of the openTCS Operations Desk application&#8217;s installation directory <em>before</em> the application is started.
(The openTCS start scripts include all JAR files in that directory in the application&#8217;s classpath.)</p>
</li>
<li>
<p>Set the <code>locationThemeClass</code> or <code>vehicleThemeClass</code> in the Operations Desk application&#8217;s configuration file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vehicles or locations in plant models are then rendered using your custom theme.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supplementing_configuration_sources">7. Supplementing configuration sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the openTCS User&#8217;s Guide, the openTCS Kernel, Kernel Control Center, Model Editor and Operations Desk applications read their configurations from properties files.
This functionality is provided by the <a href="http://www.cfg4j.org/">cfg4j</a> library.</p>
</div>
<div class="paragraph">
<p>It is possible to register additional configuration sources, e.g. for reading configuration data from network resources or files in different formats.
The mechanism provided by <code>java.util.ServiceLoader</code> is used for this.
The following steps are required for registering a configuration source:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build a JAR file with the following content:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>An implementation of <code>SupplementaryConfigurationSource</code>.
This interface is part of the <code>opentcs-impl-configuration-cfg4j</code> artifact, which must be on your project&#8217;s classpath.</p>
</li>
<li>
<p>A plain text file named <code>META-INF/services/org.opentcs.configuration.cfg4j.SupplementaryConfigurationSource</code>.
This file should contain a single line of text with the fully qualified class name of your implementation.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ensure that the JAR file is part of the classpath when you start the respective application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is possible to register multiple supplementary configuration sources this way.</p>
</div>
<div class="paragraph">
<p>The configuration entries provided by any registered supplementary configuration source may override configuration entries provided by the properties files that are read by default.
Note that the order in which these additional configuration sources are processed is unspecified.</p>
</div>
<div class="paragraph">
<p>For more information on how the automatic registration works, see the documentation of <code>java.util.ServiceLoader</code> in the Java class library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_translating_the_user_interfaces">8. Translating the user interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each openTCS application with a user interface is prepared for internationalization based on Java&#8217;s <code>ResourceBundle</code> mechanism.
As a result, the applications can be configured to display texts in different languages, provided there is a translation in the form of resource bundle property files.
(How this configuration works is described in the User&#8217;s Guide.)
The openTCS distribution itself comes with language files for the default language (English) and German.
Additional translations can be integrated primarily by adding JAR files containing property files to the class path.</p>
</div>
<div class="paragraph">
<p>The following sections explain how to create and integrate a new translation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Parts of the texts in the distribution may change between openTCS releases.
While this might not happen often, it still means that, when you update to a new version of openTCS, you may want to check whether your translations are still correct.
If there were textual changes in the openTCS distribution, you may need to update your language files.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_extracting_default_language_files">8.1. Extracting default language files</h3>
<div class="paragraph">
<p>To create a new translation pack for an application, you first need to know what texts to translate.
The best way to do this is to look at the existing language files in the openTCS distribution.
These are contained in the applications' JAR files (<code>opentcs-*.jar</code>), and are by convention kept in a common directory <code>/i18n/org/opentcs</code> inside these JAR files.</p>
</div>
<div class="paragraph">
<p>To start your translation work, extract all of the application&#8217;s language files into a single directory first.
Since JAR files are really only ZIP files, this can be done using any ZIP utility you like.
As an example, to use <code>unzip</code> in a shell on a Linux system, issue the following command from the application&#8217;s <code>lib/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>unzip "opentcs-*.jar" "i18n/org/opentcs/*.properties"</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, to use <a href="https://7-zip.org/">7-Zip</a> in a shell on a Windows system, issue the following command from the application&#8217;s <code>lib/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>7z x -r "opentcs-*.jar" "i18n\org\opentcs\*.properties"</pre>
</div>
</div>
<div class="paragraph">
<p>You will find the extracted language files in the <code>i18n/</code> directory, then.
For the Model Editor or Operations Desk application, an excerpt of that directory&#8217;s contents would look similar to this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>i18n/
  org/
    opentcs/
      plantoverview/
        mainMenu.properties
        mainMenu_de.properties
        toolbar.properties
        toolbar_de.properties
        ...</pre>
</div>
</div>
<div class="paragraph">
<p>Files whose names end with <code>_de.properties</code> are German translations.
You will not need these and can delete them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_translation">8.2. Creating a translation</h3>
<div class="paragraph">
<p>Copy the whole <code>i18n/</code> directory with the English language files to a new, separate directory, e.g. <code>translation/</code>.
Working with a copy ensures that you still have the English version at hand to look up the original texts when translating.</p>
</div>
<div class="paragraph">
<p>Then rename all property files in the new directory so their names contain the appropriate language tag for your translation.
If you are e.g. translating to Norwegian, rename <code>mainMenu.properties</code> to <code>mainMenu_no.properties</code> and the other files accordingly.
It is important that the base name of the file remains the same and only the language tag is added to it.</p>
</div>
<div class="paragraph">
<p>The next step is doing the actual translation work&#8201;&#8212;&#8201;open each property file in a text editor and translate the properties' values in it.</p>
</div>
<div class="paragraph">
<p>After translating all the files, create a JAR file containing the <code>i18n/</code> directory with your language files.
You can do this for instance by simply creating a ZIP file and changing its name to end with <code>.jar</code>.</p>
</div>
<div class="paragraph">
<p>The result could be a file named e.g. <code>language-pack-norwegian.jar</code>, whose contents should look similar to this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>i18n/
  org/
    opentcs/
      plantoverview/
        mainMenu_no.properties
        toolbar_no.properties
        ...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_a_translation">8.3. Integrating a translation</h3>
<div class="paragraph">
<p>Finally, you merely need to add the JAR file you created to the translated application&#8217;s class path.
After configuring the application to the respective language and restarting it, you should see your translations in the user interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_updating_a_translation">8.4. Updating a translation</h3>
<div class="paragraph">
<p>As development of openTCS proceeds, parts of the applications' language files may change.
This means that your translations may also need to be updated when you move from one version of openTCS to a more recent one.</p>
</div>
<div class="paragraph">
<p>To find out what changes were made and may need to be applied to your translations, you could do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extract the language files for the old version of the application, e.g. into a directory <code>translation_old/</code>.</p>
</li>
<li>
<p>Extract the language files for the new version of the application, e.g. into a directory <code>translation_new/</code>.</p>
</li>
<li>
<p>Create a <a href="https://en.wikipedia.org/wiki/Diff">diff</a> between the two language file versions.
For example, on a Linux system you could run <code>diff -urN translation_old/ translation_new/ &gt; language_changes.diff</code> to write a diff to the file <code>language_changes.diff</code>.</p>
</li>
<li>
<p>Read the diff to see which new language files and/or entries were added, removed or changed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Based on the information from the diff, you can apply appropriate changes to your own language files.
Then you merely need to create new JAR files for your translations and add them to the applications' class paths.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 5.11.0<br>
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>